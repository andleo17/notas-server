# Migration `20200926023035-base-de-datos-inicial`

This migration has been generated by andleo17 at 9/25/2020, 9:30:35 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Faculty" (
"id" SERIAL,
"name" text   NOT NULL ,
"state" boolean   NOT NULL DEFAULT true,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."School" (
"id" SERIAL,
"name" text   NOT NULL ,
"state" boolean   NOT NULL DEFAULT true,
"facultyId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Semester" (
"id" SERIAL,
"name" text   NOT NULL ,
"startDate" timestamp(3)   ,
"finishDate" timestamp(3)   ,
"state" boolean   NOT NULL DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" SERIAL,
"nickname" text   NOT NULL ,
"password" text   NOT NULL ,
"email" text   NOT NULL ,
"name" text   NOT NULL ,
"lastname" text   NOT NULL ,
"birthDate" timestamp(3)   NOT NULL ,
"photo" text   NOT NULL ,
"genre" boolean   NOT NULL ,
"semesterId" integer   NOT NULL ,
"schoolId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Course" (
"id" SERIAL,
"name" text   NOT NULL ,
"code" text   NOT NULL ,
"credits" integer   NOT NULL ,
"academicPhase" integer   NOT NULL ,
"state" boolean   NOT NULL DEFAULT true,
"schoolId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Teacher" (
"id" SERIAL,
"name" text   NOT NULL ,
"lastname" text   NOT NULL ,
"state" boolean   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Group" (
"id" SERIAL,
"denomination" text   NOT NULL ,
"courseId" integer   NOT NULL ,
"teacherId" integer   NOT NULL ,
"semesterId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Enrollment" (
"id" SERIAL,
"weightedAverage" integer   ,
"state" boolean   NOT NULL DEFAULT true,
"userId" integer   NOT NULL ,
"semesterId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EnrollmentDetail" (
"id" SERIAL,
"averageGrade" Decimal(65,30)   ,
"state" boolean   NOT NULL ,
"enrollmentId" integer   NOT NULL ,
"groupId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TypeActivity" (
"id" SERIAL,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Activity" (
"id" SERIAL,
"name" text   NOT NULL ,
"weight" Decimal(65,30)   NOT NULL ,
"presentationDate" timestamp(3)   ,
"state" boolean   NOT NULL DEFAULT true,
"typeActivityId" integer   NOT NULL ,
"activityId" integer   ,
"groupId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Grade" (
"id" SERIAL,
"calification" Decimal(65,30)   ,
"confirmated" boolean   NOT NULL DEFAULT false,
"state" boolean   NOT NULL DEFAULT true,
"activityId" integer   NOT NULL ,
"enrollmentDetailId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Schedule" (
"id" SERIAL,
"day" integer   NOT NULL ,
"startHour" timestamp(3)   NOT NULL ,
"finishHour" timestamp(3)   NOT NULL ,
"state" boolean   NOT NULL DEFAULT true,
"groupId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Faculty.name_unique" ON "public"."Faculty"("name")

CREATE UNIQUE INDEX "School.name_unique" ON "public"."School"("name")

CREATE UNIQUE INDEX "Semester.name_unique" ON "public"."Semester"("name")

CREATE UNIQUE INDEX "Course.code_unique" ON "public"."Course"("code")

CREATE UNIQUE INDEX "TypeActivity.name_unique" ON "public"."TypeActivity"("name")

ALTER TABLE "public"."School" ADD FOREIGN KEY ("facultyId")REFERENCES "public"."Faculty"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("semesterId")REFERENCES "public"."Semester"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("schoolId")REFERENCES "public"."School"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Course" ADD FOREIGN KEY ("schoolId")REFERENCES "public"."School"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Group" ADD FOREIGN KEY ("courseId")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Group" ADD FOREIGN KEY ("teacherId")REFERENCES "public"."Teacher"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Group" ADD FOREIGN KEY ("semesterId")REFERENCES "public"."Semester"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Enrollment" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Enrollment" ADD FOREIGN KEY ("semesterId")REFERENCES "public"."Semester"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EnrollmentDetail" ADD FOREIGN KEY ("enrollmentId")REFERENCES "public"."Enrollment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EnrollmentDetail" ADD FOREIGN KEY ("groupId")REFERENCES "public"."Group"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Activity" ADD FOREIGN KEY ("typeActivityId")REFERENCES "public"."TypeActivity"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Activity" ADD FOREIGN KEY ("activityId")REFERENCES "public"."Activity"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Activity" ADD FOREIGN KEY ("groupId")REFERENCES "public"."Group"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Grade" ADD FOREIGN KEY ("activityId")REFERENCES "public"."Activity"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Grade" ADD FOREIGN KEY ("enrollmentDetailId")REFERENCES "public"."EnrollmentDetail"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Schedule" ADD FOREIGN KEY ("groupId")REFERENCES "public"."Group"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200926023035-base-de-datos-inicial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,155 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Faculty {
+  id      Int      @default(autoincrement()) @id
+  name    String   @unique
+  state   Boolean  @default(true)
+  schools School[]
+}
+
+model School {
+  id        Int      @default(autoincrement()) @id
+  name      String   @unique
+  state     Boolean  @default(true)
+  facultyId Int
+  faculty   Faculty  @relation(fields: [facultyId], references: [id])
+  users     User[]
+  courses   Course[]
+}
+
+model Semester {
+  id          Int          @default(autoincrement()) @id
+  name        String       @unique
+  startDate   DateTime?
+  finishDate  DateTime?
+  state       Boolean      @default(false)
+  users       User[]
+  groups      Group[]
+  enrollments Enrollment[]
+}
+
+model User {
+  id          Int          @default(autoincrement()) @id
+  nickname    String
+  password    String
+  email       String
+  name        String
+  lastname    String
+  birthDate   DateTime
+  photo       String
+  genre       Boolean
+  semesterId  Int
+  semester    Semester     @relation(fields: [semesterId], references: [id])
+  schoolId    Int
+  school      School       @relation(fields: [schoolId], references: [id])
+  enrollments Enrollment[]
+}
+
+model Course {
+  id            Int     @default(autoincrement()) @id
+  name          String
+  code          String  @unique
+  credits       Int
+  academicPhase Int
+  state         Boolean @default(true)
+  schoolId      Int
+  school        School  @relation(fields: [schoolId], references: [id])
+  groups        Group[]
+}
+
+model Teacher {
+  id       Int     @default(autoincrement()) @id
+  name     String
+  lastname String
+  state    Boolean
+  groups   Group[]
+}
+
+model Group {
+  id                Int                @default(autoincrement()) @id
+  denomination      String
+  courseId          Int
+  course            Course             @relation(fields: [courseId], references: [id])
+  teacherId         Int
+  teacher           Teacher            @relation(fields: [teacherId], references: [id])
+  semesterId        Int
+  semester          Semester           @relation(fields: [semesterId], references: [id])
+  enrollmentDetails EnrollmentDetail[]
+  activities        Activity[]
+  schedules         Schedule[]
+}
+
+model Enrollment {
+  id                Int                @default(autoincrement()) @id
+  weightedAverage   Int?
+  state             Boolean            @default(true)
+  userId            Int
+  user              User               @relation(fields: [userId], references: [id])
+  semesterId        Int
+  semester          Semester           @relation(fields: [semesterId], references: [id])
+  enrollmentDetails EnrollmentDetail[]
+}
+
+model EnrollmentDetail {
+  id           Int        @default(autoincrement()) @id
+  averageGrade Float?
+  state        Boolean
+  enrollmentId Int
+  enrollment   Enrollment @relation(fields: [enrollmentId], references: [id])
+  groupId      Int
+  group        Group      @relation(fields: [groupId], references: [id])
+  grades       Grade[]
+}
+
+model TypeActivity {
+  id         Int        @default(autoincrement()) @id
+  name       String     @unique
+  activities Activity[]
+}
+
+model Activity {
+  id               Int          @default(autoincrement()) @id
+  name             String
+  weight           Float
+  presentationDate DateTime?
+  state            Boolean      @default(true)
+  typeActivityId   Int
+  typeActivity     TypeActivity @relation(fields: [typeActivityId], references: [id])
+  activityId       Int?
+  activity         Activity?    @relation("ActivityToActivity", fields: [activityId], references: [id])
+  groupId          Int
+  group            Group        @relation(fields: [groupId], references: [id])
+  activities       Activity[]   @relation("ActivityToActivity")
+  grades           Grade[]
+}
+
+model Grade {
+  id                 Int              @default(autoincrement()) @id
+  calification       Float?
+  confirmated        Boolean          @default(false)
+  state              Boolean          @default(true)
+  activityId         Int
+  activity           Activity         @relation(fields: [activityId], references: [id])
+  enrollmentDetailId Int
+  enrollmentDetail   EnrollmentDetail @relation(fields: [enrollmentDetailId], references: [id])
+}
+
+model Schedule {
+  id         Int      @default(autoincrement()) @id
+  day        Int
+  startHour  DateTime
+  finishHour DateTime
+  state      Boolean  @default(true)
+  groupId    Int
+  group      Group    @relation(fields: [groupId], references: [id])
+}
```


